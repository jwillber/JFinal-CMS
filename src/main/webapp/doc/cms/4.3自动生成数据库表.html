<html><head><meta charSet="utf-8"/><title data-react-helmet="true">4.3自动生成数据库表 · Cms · 看云</title><meta data-react-helmet="true" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/><link rel="stylesheet" href="asset/plugins/theme-default/reader/style.css"/><style data-react-helmet="true" type="text/css">.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.ಠhighlight-container code[class*=language-]::-moz-selection,.ಠhighlight-container code[class*=language-] ::-moz-selection,.ಠhighlight-container pre[class*=language-]::-moz-selection,.ಠhighlight-container pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}.ಠhighlight-container code[class*=language-]::selection,.ಠhighlight-container code[class*=language-] ::selection,.ಠhighlight-container pre[class*=language-]::selection,.ಠhighlight-container pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{.ಠhighlight-container code[class*=language-],.ಠhighlight-container pre[class*=language-]{text-shadow:none}}.ಠhighlight-container pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}.ಠhighlight-container :not(pre)>code[class*=language-],.ಠhighlight-container pre[class*=language-]{background:#f5f2f0}.ಠhighlight-container :not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.ಠhighlight-container .token.cdata,.ಠhighlight-container .token.comment,.ಠhighlight-container .token.doctype,.ಠhighlight-container .token.prolog{color:#708090}.ಠhighlight-container .token.punctuation{color:#999}.ಠhighlight-container .namespace{opacity:.7}.ಠhighlight-container .token.boolean,.ಠhighlight-container .token.constant,.ಠhighlight-container .token.deleted,.ಠhighlight-container .token.number,.ಠhighlight-container .token.property,.ಠhighlight-container .token.symbol,.ಠhighlight-container .token.tag{color:#905}.ಠhighlight-container .token.attr-name,.ಠhighlight-container .token.builtin,.ಠhighlight-container .token.char,.ಠhighlight-container .token.inserted,.ಠhighlight-container .token.selector,.ಠhighlight-container .token.string{color:#690}.ಠhighlight-container .language-css .token.string,.ಠhighlight-container .style .token.string,.ಠhighlight-container .token.entity,.ಠhighlight-container .token.operator,.ಠhighlight-container .token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.ಠhighlight-container .token.atrule,.ಠhighlight-container .token.attr-value,.ಠhighlight-container .token.keyword{color:#07a}.ಠhighlight-container .token.class-name,.ಠhighlight-container .token.function{color:#dd4a68}.ಠhighlight-container .token.important,.ಠhighlight-container .token.regex,.ಠhighlight-container .token.variable{color:#e90}.ಠhighlight-container .token.bold,.ಠhighlight-container .token.important{font-weight:700}.ಠhighlight-container .token.italic{font-style:italic}.ಠhighlight-container .token.entity{cursor:help}</style></head><body><div id="main"><div class="window-container"><img src="cover.jpg" style="position:absolute;visibility:hidden"/><div><div class="Loading__loading___1m_fZ"><div class="Loading__bar___21yOt" style="background:#21ba45;width:0%;display:none"><div class="Loading__peg___3Y_28"></div></div></div><div class="Loading__spinner___11Pm4"><div class="Loading__icon___3OOyu" style="display:none;border-color:#21ba45"></div></div></div><div class="window-body"><div class="sidebar"><div class="sidebar-header"><a href="." class="title">Cms</a><div class="search-form"><div class="ui small fluid icon input"><input type="text" placeholder="请输入搜索关键词..."/><i class="icon search"></i></div></div></div><div class="sidebar-body"><div class="catalog-body"><ul><li class=""><div class="wholerow"></div><i class="icon caret right"></i><a href="1.Cms概述.html" class="text">1.Cms概述</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="1.1技术框架.html" class="text">1.1技术框架</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="1.2代码介绍.html" class="text">1.2代码介绍</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="1.3后台功能.html" class="text">1.3后台功能</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="1.4配置文件.html" class="text">1.4配置文件</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon caret right"></i><a href="2.快速开始.html" class="text">2.快速开始</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="2.1环境文件.html" class="text">2.1环境文件</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="2.2导入项目.html" class="text">2.2导入项目</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="2.3运行项目.html" class="text">2.3运行项目</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon caret right"></i><a href="3.模板标签.html" class="text">3.模板标签</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.1广告位.html" class="text">3.1广告位</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.2子栏目列表.html" class="text">3.2子栏目列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.3单个栏目.html" class="text">3.3单个栏目</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.4父栏目列表.html" class="text">3.4父栏目列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.5根栏目列表.html" class="text">3.5根栏目列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.6单个内容.html" class="text">3.6单个内容</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.7内容列表.html" class="text">3.7内容列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.8友情链接列表.html" class="text">3.8友情链接列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.9分页.html" class="text">3.9分页</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.10SQL列表.html" class="text">3.10SQL列表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="3.11内容分页.html" class="text">3.11内容分页</a></li></ul></li><li class="open"><div class="wholerow"></div><i class="icon caret down"></i><a href="4.帮助文档.html" class="text">4.帮助文档</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.1Ehcache页面缓存.html" class="text">4.1Ehcache页面缓存</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.2Excel文件生成并下载.html" class="text">4.2Excel文件生成并下载</a></li><li class=""><div class="wholerow"></div><i class="icon caret right"></i><a href="4.2文件存储.html" class="text">4.2文件存储</a><ul><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.2.1OSS.html" class="text">4.2.1OSS</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.2.2FTP.html" class="text">4.2.2FTP</a></li></ul></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.3自动生成数据库表.html" class="text">4.3自动生成数据库表</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.4防跨域过滤器.html" class="text">4.4防跨域过滤器</a></li><li class=""><div class="wholerow"></div><i class="icon"></i><a href="4.5伪静态.html" class="text">4.5伪静态</a></li></ul></li></ul></div></div><div class="sidebar-copyright">本文档使用 <a href="https://www.kancloud.cn" target="_blank">看云</a> 构建</div></div><div class="workspace"><div class="article"><div class="article-head"><div class="left tools"><a class="item icon"><i class="icon align justify"></i></a></div><h1>4.3自动生成数据库表</h1><div class="right tools"><div role="listbox" aria-expanded="false" class="ui top right pointing dropdown item" tabindex="0"><div class="text" role="alert" aria-live="polite"></div><i aria-hidden="true" class="share alternate icon"></i><div class="menu transition"><div role="option" class="item"><i aria-hidden="true" class="linkify icon"></i><span class="text">复制链接</span></div><div role="option" class="item"><i aria-hidden="true" class="qq icon"></i><span class="text">腾讯QQ</span></div><div role="option" class="item"><i aria-hidden="true" class="weibo icon"></i><span class="text">新浪微博</span></div><div class="header"><p><i class="icon wechat"></i><span class="text">微信扫一扫</span></p><img src="https://bshare.optimix.asia/barCode?site=weixin&amp;url=file%3A%2F%2F.%2Fcontent%2F4.3%25E8%2587%25AA%25E5%258A%25A8%25E7%2594%259F%25E6%2588%2590%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%25E8%25A1%25A8.md"/></div></div></div></div></div><div class="article-body kancloud-markdown-body"><pre><code class="ಠhighlight-container">import java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
import java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span>
import java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span>
import java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
import java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
import com<span class="token punctuation">.</span>jfinal<span class="token punctuation">.</span>kit<span class="token punctuation">.</span>PathKit<span class="token punctuation">;</span>
import com<span class="token punctuation">.</span>jfinal<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>activerecord<span class="token punctuation">.</span>Db<span class="token punctuation">;</span>

public class <span class="token class-name">AutoCreateTable</span> <span class="token punctuation">{</span>

    <span class="token comment">//扫描类</span>
    private static void <span class="token function">scanClass</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>File<span class="token operator">></span> fileList<span class="token punctuation">,</span> String path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        File files<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> files <span class="token operator">||</span> files<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>File file <span class="token punctuation">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">scanClass</span><span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fileList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//加载类</span>
    @<span class="token function">SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
    private static <span class="token operator">&lt;</span>T<span class="token operator">></span> Class<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token function">classForName</span><span class="token punctuation">(</span>String className<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Class<span class="token operator">&lt;</span>T<span class="token operator">></span> clazz <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            ClassLoader cl <span class="token operator">=</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            clazz <span class="token operator">=</span> <span class="token punctuation">(</span>Class<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> cl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//创建</span>
    public static void <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// TODO Auto-generated method stub</span>
        List<span class="token operator">&lt;</span>File<span class="token operator">></span> classFileList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>File<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//entity class目录</span>
        <span class="token function">scanClass</span><span class="token punctuation">(</span>classFileList<span class="token punctuation">,</span> PathKit<span class="token punctuation">.</span><span class="token function">getRootClassPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"/com/cms/autocode/c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>File file <span class="token punctuation">:</span> classFileList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            int start <span class="token operator">=</span> PathKit<span class="token punctuation">.</span><span class="token function">getRootClassPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            int end <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 6 == ".class".length();</span>

            String classFile <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> clazz <span class="token operator">=</span> <span class="token function">classForName</span><span class="token punctuation">(</span>classFile<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span>separator<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            String tableName <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String firstName <span class="token operator">=</span>  tableName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            String endName <span class="token operator">=</span> tableName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            char <span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> endName<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>char c <span class="token punctuation">:</span> chars<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token operator">&lt;</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    firstName<span class="token operator">+</span><span class="token operator">=</span><span class="token string">"_"</span><span class="token operator">+</span>c<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    firstName<span class="token operator">+</span><span class="token operator">=</span>c<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            String sql <span class="token operator">=</span> <span class="token string">" CREATE TABLE `cms_"</span><span class="token operator">+</span>firstName<span class="token operator">+</span><span class="token string">"` ( "</span><span class="token operator">+</span>
                    <span class="token string">" `id`  bigint(20) NOT NULL AUTO_INCREMENT, "</span><span class="token operator">+</span>
                    <span class="token string">" `createDate`  datetime NOT NULL, "</span><span class="token operator">+</span>
                    <span class="token string">" `modifyDate`  datetime NOT NULL "</span><span class="token punctuation">;</span>
            Method<span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>Method method <span class="token punctuation">:</span> methods<span class="token punctuation">)</span><span class="token punctuation">{</span>
                String name <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    String first <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    name <span class="token operator">=</span> first<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"createDate"</span><span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"modifyDate"</span><span class="token punctuation">)</span> <span class="token operator">||</span> name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"siteId"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> type <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//text,longtext 类型需自己去修改</span>
                            sql<span class="token operator">+</span><span class="token operator">=</span><span class="token string">" ,`"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"`  varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL "</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            sql<span class="token operator">+</span><span class="token operator">=</span><span class="token string">" ,`"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"`  bit(1) NULL "</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            sql<span class="token operator">+</span><span class="token operator">=</span><span class="token string">" ,`"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"`  bigint(20) NULL "</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            sql<span class="token operator">+</span><span class="token operator">=</span><span class="token string">" ,`"</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">"`  datetime NULL "</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            sql<span class="token operator">+</span><span class="token operator">=</span><span class="token string">" ,PRIMARY KEY (`id`)"</span><span class="token operator">+</span><span class="token string">") "</span><span class="token operator">+</span><span class="token string">" ENGINE=InnoDB "</span><span class="token operator">+</span>
                <span class="token string">" DEFAULT CHARACTER SET=utf8 COLLATE=utf8_general_ci "</span><span class="token operator">+</span>
                <span class="token string">" AUTO_INCREMENT=1 "</span><span class="token operator">+</span>
                <span class="token string">" ROW_FORMAT=COMPACT "</span><span class="token operator">+</span>
                <span class="token string">";"</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
</div><div class="article-navigation"><span class="prev">上一篇：<a href="4.2.2FTP.html">4.2.2FTP</a></span><span class="next">下一篇：<a href="4.4防跨域过滤器.html">4.4防跨域过滤器</a></span></div><div class="article-foot"></div></div></div></div></div></div><script src="asset/reader.js"></script><script src="asset/plugins/highlight/reader/index.js"></script><script src="asset/plugins/search/reader/index.js"></script><script src="asset/plugins/theme-default/reader/index.js"></script><script type="application/payload+json">{"config":{"plugins":["highlight","search"],"cover":"cover.jpg","title":"Cms","id":410767,"description":"Cms内容管理系统，极速开发，自定义模型，自定义字段，多站点，一键生成模板代码，让您轻松打造自己的独立网站，同时也方便二次开发，让您快速搭建个性化独立网站，为您节约更多时间，去陪恋人、家人和朋友。"},"summary":[{"level":"1","title":"1.Cms概述","ref":"1.Cms概述.md","path":"1.Cms概述.html","articles":[{"level":"1.1","title":"1.1技术框架","ref":"1.1技术框架.md","path":"1.1技术框架.html","articles":[]},{"level":"1.2","title":"1.2代码介绍","ref":"1.2代码介绍.md","path":"1.2代码介绍.html","articles":[]},{"level":"1.3","title":"1.3后台功能","ref":"1.3后台功能.md","path":"1.3后台功能.html","articles":[]},{"level":"1.4","title":"1.4配置文件","ref":"1.4配置文件.md","path":"1.4配置文件.html","articles":[]}]},{"level":"2","title":"2.快速开始","ref":"2.快速开始.md","path":"2.快速开始.html","articles":[{"level":"2.1","title":"2.1环境文件","ref":"2.1环境文件.md","path":"2.1环境文件.html","articles":[]},{"level":"2.2","title":"2.2导入项目","ref":"2.2导入项目.md","path":"2.2导入项目.html","articles":[]},{"level":"2.3","title":"2.3运行项目","ref":"2.3运行项目.md","path":"2.3运行项目.html","articles":[]}]},{"level":"3","title":"3.模板标签","ref":"3.模板标签.md","path":"3.模板标签.html","articles":[{"level":"3.1","title":"3.1广告位","ref":"3.1广告位.md","path":"3.1广告位.html","articles":[]},{"level":"3.2","title":"3.2子栏目列表","ref":"3.2子栏目列表.md","path":"3.2子栏目列表.html","articles":[]},{"level":"3.3","title":"3.3单个栏目","ref":"3.3单个栏目.md","path":"3.3单个栏目.html","articles":[]},{"level":"3.4","title":"3.4父栏目列表","ref":"3.4父栏目列表.md","path":"3.4父栏目列表.html","articles":[]},{"level":"3.5","title":"3.5根栏目列表","ref":"3.5根栏目列表.md","path":"3.5根栏目列表.html","articles":[]},{"level":"3.6","title":"3.6单个内容","ref":"3.6单个内容.md","path":"3.6单个内容.html","articles":[]},{"level":"3.7","title":"3.7内容列表","ref":"3.7内容列表.md","path":"3.7内容列表.html","articles":[]},{"level":"3.8","title":"3.8友情链接列表","ref":"3.8友情链接列表.md","path":"3.8友情链接列表.html","articles":[]},{"level":"3.9","title":"3.9分页","ref":"3.9分页.md","path":"3.9分页.html","articles":[]},{"level":"3.10","title":"3.10SQL列表","ref":"3.10SQL列表.md","path":"3.10SQL列表.html","articles":[]},{"level":"3.11","title":"3.11内容分页","ref":"3.11内容分页.md","path":"3.11内容分页.html","articles":[]}]},{"level":"4","title":"4.帮助文档","ref":"4.帮助文档.md","path":"4.帮助文档.html","articles":[{"level":"4.1","title":"4.1Ehcache页面缓存","ref":"4.1Ehcache页面缓存.md","path":"4.1Ehcache页面缓存.html","articles":[]},{"level":"4.2","title":"4.2Excel文件生成并下载","ref":"4.2Excel文件生成并下载.md","path":"4.2Excel文件生成并下载.html","articles":[]},{"level":"4.3","title":"4.2文件存储","ref":"4.2文件存储.md","path":"4.2文件存储.html","articles":[{"level":"4.3.1","title":"4.2.1OSS","ref":"4.2.1OSS.md","path":"4.2.1OSS.html","articles":[]},{"level":"4.3.2","title":"4.2.2FTP","ref":"4.2.2FTP.md","path":"4.2.2FTP.html","articles":[]}]},{"level":"4.4","title":"4.3自动生成数据库表","ref":"4.3自动生成数据库表.md","path":"4.3自动生成数据库表.html","articles":[]},{"level":"4.5","title":"4.4防跨域过滤器","ref":"4.4防跨域过滤器.md","path":"4.4防跨域过滤器.html","articles":[]},{"level":"4.6","title":"4.5伪静态","ref":"4.5伪静态.md","path":"4.5伪静态.html","articles":[]}]}],"article":{"path":"4.3自动生成数据库表.html","ref":"4.3自动生成数据库表.md","title":"4.3自动生成数据库表","content":"```\nimport java.io.File;\r\nimport java.lang.reflect.Method;\r\nimport java.util.ArrayList;\r\nimport java.util.Date;\r\nimport java.util.List;\r\nimport com.jfinal.kit.PathKit;\r\nimport com.jfinal.plugin.activerecord.Db;\r\n\r\npublic class AutoCreateTable {\r\n\r\n    \/\/扫描类\r\n    private static void scanClass(List<File> fileList, String path) {\r\n        File files[] = new File(path).listFiles();\r\n        if (null == files || files.length == 0)\r\n            return;\r\n        for (File file : files) {\r\n            if (file.isDirectory()) {\r\n                scanClass(fileList, file.getAbsolutePath());\r\n            } else if (file.getName().endsWith(\".class\")) {\r\n                fileList.add(file);\r\n            }\r\n        }\r\n    }\r\n    \r\n    \/\/加载类\r\n    @SuppressWarnings(\"unchecked\")\r\n    private static <T> Class<T> classForName(String className) {\r\n        Class<T> clazz = null;\r\n        try {\r\n            ClassLoader cl = Thread.currentThread().getContextClassLoader();\r\n            clazz = (Class<T>) Class.forName(className, false, cl);\r\n        } catch (Throwable e) {\r\n        }\r\n        return clazz;\r\n    }\r\n    \r\n    \/\/创建\r\n    public static void create(){\r\n        \/\/ TODO Auto-generated method stub\r\n        List<File> classFileList = new ArrayList<File>();\r\n        \/\/entity class目录\r\n        scanClass(classFileList, PathKit.getRootClassPath()+\"\/com\/cms\/autocode\/c\");\r\n        for (File file : classFileList) {\r\n            int start = PathKit.getRootClassPath().length();\r\n            int end = file.toString().length() - 6; \/\/ 6 == \".class\".length();\r\n\r\n            String classFile = file.toString().substring(start + 1, end);\r\n            Class<?> clazz = classForName(classFile.replace(File.separator, \".\"));\r\n            \r\n            String tableName = clazz.getSimpleName().substring(4);\r\n            String firstName =  tableName.substring(0,1).toLowerCase();\r\n            \r\n            String endName = tableName.substring(1);\r\n            char [] chars = endName.toCharArray();\r\n            for(char c : chars){\r\n                if (c<97){\r\n                    firstName+=\"_\"+c;\r\n                }else{\r\n                    firstName+=c;\r\n                }\r\n            }\r\n            String sql = \" CREATE TABLE `cms_\"+firstName+\"` ( \"+\r\n                    \" `id`  bigint(20) NOT NULL AUTO_INCREMENT, \"+\r\n                    \" `createDate`  datetime NOT NULL, \"+\r\n                    \" `modifyDate`  datetime NOT NULL \";\r\n            Method[] methods = clazz.getDeclaredMethods();\r\n            for(Method method : methods){\r\n                String name = method.getName();\r\n                if(name.startsWith(\"get\")){\r\n                    name = name.substring(\"get\".length());\r\n                    String first = name.substring(0, 1);\r\n                    name = first.toLowerCase()+name.substring(1);\r\n                    if(name.equals(\"id\") || name.equals(\"createDate\") || name.equals(\"modifyDate\") || name.equals(\"siteId\")){\r\n                        continue;\r\n                    }else{\r\n                        Class<?> type = method.getReturnType();\r\n                        if(type.isAssignableFrom(String.class)){ \/\/text,longtext 类型需自己去修改\r\n                            sql+=\" ,`\"+name+\"`  varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL \";\r\n                        }\r\n                        if(type.isAssignableFrom(Boolean.class)){\r\n                            sql+=\" ,`\"+name+\"`  bit(1) NULL \";\r\n                        }\r\n                        if(type.isAssignableFrom(Long.class)){\r\n                            sql+=\" ,`\"+name+\"`  bigint(20) NULL \";\r\n                        }\r\n                        if(type.isAssignableFrom(Date.class)){\r\n                            sql+=\" ,`\"+name+\"`  datetime NULL \";\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            sql+=\" ,PRIMARY KEY (`id`)\"+\") \"+\" ENGINE=InnoDB \"+\r\n                \" DEFAULT CHARACTER SET=utf8 COLLATE=utf8_general_ci \"+\r\n                \" AUTO_INCREMENT=1 \"+\r\n                \" ROW_FORMAT=COMPACT \"+\r\n                \";\";\r\n            System.out.println(sql);\r\n            Db.update(sql);\r\n        }\r\n    }\r\n\r\n}\n```"},"options":{"base":".\/","environment":"reader"},"style":""}</script><script type="text/javascript">kancloud.bootstrap('app');</script></body></html>